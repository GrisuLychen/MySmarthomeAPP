<script>
    const lightSwitch = document.getElementById('lightSwitch');
    const lightBulb = document.getElementById('lightBulb');

    // Funktion, die den Befehl an den Telegram Bot sendet
    function sendCommand(command) {
        if (window.Telegram && window.Telegram.WebApp) {
            // Sende den Befehl über die Telegram API
            window.Telegram.WebApp.sendData(command); 
            
            // Schließe die Web App sofort nach dem Senden, um die Datenübertragung zu erzwingen
            window.Telegram.WebApp.close(); 

        } else {
            console.error("Telegram WebApp SDK nicht geladen. Lokaler Test.");
            alert(`Simuliere Befehl: ${command}`);
        }
    }

    // Listener für den Schalter
    lightSwitch.addEventListener('change', function() {
        let command = '';
        if (this.checked) {
            // Schalter AN: Sende "Licht ein" Befehl
            lightBulb.classList.add('on');
            command = '!twa_lichtein'; 
        } else {
            // Schalter AUS: Sende "Licht aus" Befehl
            lightBulb.classList.remove('on');
            command = '!twa_lichtaus'; 
        }
        
        // Befehl senden
        sendCommand(command);
    });
    
    // Telegram Web App initialisieren (wichtig für die korrekte Umgebung)
    if (window.Telegram && window.Telegram.WebApp) {
         window.Telegram.WebApp.ready();
    } else {
         lightSwitch.disabled = false;
    }
</script>
